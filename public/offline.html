<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Offline - Clean City Waste Management</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/images/logo.png">
    <link rel="shortcut icon" href="/images/logo.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Quicksand', sans-serif;
        }
        
        .offline-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes bounce-gentle {
            0%, 100% {
                transform: translateY(-5px);
            }
            50% {
                transform: translateY(0px);
            }
        }
        
        .bounce-gentle {
            animation: bounce-gentle 2s ease-in-out infinite;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center">
    
    <!-- Offline Page Content -->
    <div class="max-w-md mx-auto px-6 py-8 bg-white rounded-xl shadow-lg text-center">
        <!-- Logo and Icon -->
        <div class="mb-6">
            <div class="w-24 h-24 mx-auto mb-4 gradient-bg rounded-full flex items-center justify-center bounce-gentle">
                <i class="fas fa-wifi-slash text-white text-3xl"></i>
            </div>
            <img src="/images/logo.png" alt="Clean City" class="w-16 h-16 mx-auto opacity-80">
        </div>
        
        <!-- Main Message -->
        <h1 class="text-2xl font-bold text-gray-800 mb-4">You're Offline</h1>
        <p class="text-gray-600 mb-6">
            It looks like you've lost your internet connection. Don't worry - we've saved some content for you to browse offline!
        </p>
        
        <!-- Offline Features -->
        <div class="bg-gray-50 rounded-lg p-4 mb-6">
            <h3 class="font-semibold text-gray-800 mb-3">Available Offline:</h3>
            <div class="space-y-2 text-sm text-gray-600">
                <div class="flex items-center justify-center">
                    <i class="fas fa-check text-green-500 mr-2"></i>
                    <span>View cached collection history</span>
                </div>
                <div class="flex items-center justify-center">
                    <i class="fas fa-check text-green-500 mr-2"></i>
                    <span>Browse payment records</span>
                </div>
                <div class="flex items-center justify-center">
                    <i class="fas fa-check text-green-500 mr-2"></i>
                    <span>Access profile information</span>
                </div>
                <div class="flex items-center justify-center">
                    <i class="fas fa-clock text-yellow-500 mr-2"></i>
                    <span>Form submissions will sync when back online</span>
                </div>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="space-y-3">
            <button onclick="tryReconnect()" 
                    class="w-full bg-green-500 hover:bg-green-600 text-white py-3 px-6 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105 focus:ring-4 focus:ring-green-200">
                <i class="fas fa-sync-alt mr-2"></i>
                Try Again
            </button>
            
            <a href="/resident/dashboard" 
               class="block w-full bg-gray-200 hover:bg-gray-300 text-gray-700 py-3 px-6 rounded-lg font-semibold transition-colors text-center">
                <i class="fas fa-home mr-2"></i>
                Browse Offline Content
            </a>
        </div>
        
        <!-- Connection Status -->
        <div class="mt-6 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
            <div class="flex items-center justify-center text-sm text-yellow-700">
                <i class="fas fa-info-circle mr-2"></i>
                <span id="connection-status">Checking connection...</span>
            </div>
        </div>
    </div>
    
    <!-- PWA Update Banner (if available) -->
    <div id="pwa-update-banner" class="hidden fixed bottom-4 left-4 right-4 bg-blue-500 text-white p-4 rounded-lg shadow-lg max-w-sm mx-auto">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <i class="fas fa-download mr-3"></i>
                <div class="text-sm">
                    <p class="font-semibold">App Update Available</p>
                    <p class="opacity-90">Install the latest version</p>
                </div>
            </div>
            <button onclick="installPWA()" class="bg-white text-blue-500 px-3 py-1 rounded text-sm font-semibold hover:bg-gray-100 transition-colors">
                Install
            </button>
        </div>
    </div>

    <script>
        // Connection Status Checker
        function updateConnectionStatus() {
            const statusElement = document.getElementById('connection-status');
            if (navigator.onLine) {
                statusElement.innerHTML = '<i class="fas fa-wifi mr-1"></i> Connection restored! Refreshing...';
                statusElement.className = 'text-green-700';
                setTimeout(() => {
                    window.location.reload();
                }, 1500);
            } else {
                statusElement.innerHTML = '<i class="fas fa-wifi-slash mr-1"></i> Still offline';
                statusElement.className = 'text-red-700';
            }
        }
        
        // Try to reconnect
        function tryReconnect() {
            updateConnectionStatus();
            if (navigator.onLine) {
                window.location.reload();
            } else {
                // Show visual feedback
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Checking...';
                button.disabled = true;
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;
                    updateConnectionStatus();
                }, 2000);
            }
        }
        
        // PWA Installation
        function installPWA() {
            if (window.cleanCityPWA && window.cleanCityPWA.deferredPrompt) {
                window.cleanCityPWA.triggerInstallPrompt();
            }
        }
        
        // Event listeners
        window.addEventListener('online', updateConnectionStatus);
        window.addEventListener('offline', updateConnectionStatus);
        
        // Check PWA availability
        window.addEventListener('beforeinstallprompt', (e) => {
            document.getElementById('pwa-update-banner').classList.remove('hidden');
        });
        
        // Initial status check
        document.addEventListener('DOMContentLoaded', () => {
            updateConnectionStatus();
            
            // Auto-refresh check every 30 seconds
            setInterval(() => {
                if (navigator.onLine) {
                    updateConnectionStatus();
                }
            }, 30000);
        });
        
        // Service Worker messaging
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.addEventListener('message', (event) => {
                if (event.data && event.data.type === 'CACHE_UPDATED') {
                    console.log('Cache updated while offline');
                }
            });
        }
        
        // Add smooth animations
        document.addEventListener('DOMContentLoaded', () => {
            // Fade in animation
            document.body.style.opacity = '0';
            setTimeout(() => {
                document.body.style.transition = 'opacity 0.5s ease-in';
                document.body.style.opacity = '1';
            }, 100);
        });
    </script>
</body>
</html>